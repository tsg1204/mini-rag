<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>A Practical Guide on Building AI Agents</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">A Practical Guide on Building AI Agents</h1>
</header>
<section data-field="subtitle" class="p-summary">
This is the guide I wish I had when I started building agents
</section>
<section data-field="body" class="e-content">
<section name="2601" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="f1d9" id="f1d9" class="graf graf--h3 graf--leading graf--title">A Practical Guide on Building AIÂ Agents</h3><figure name="d990" id="d990" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*HE7uBmUszwMf-10m2fEo0g.png" data-width="1536" data-height="1024" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*HE7uBmUszwMf-10m2fEo0g.png"></figure><h3 name="0aee" id="0aee" class="graf graf--h3 graf-after--figure">What Youâ€™llÂ Learn</h3><p name="855a" id="855a" class="graf graf--p graf-after--h3">By the end of this guide, youâ€™ll understand:</p><ul class="postList"><li name="6840" id="6840" class="graf graf--li graf-after--p">What an AI agent is in practical terms.</li><li name="3d8f" id="3d8f" class="graf graf--li graf-after--li">Why they matter for developers today.</li><li name="6474" id="6474" class="graf graf--li graf-after--li">How to design a small, <strong class="markup--strong markup--li-strong">working agent workflow in TypeScript + Next.js.</strong></li><li name="8964" id="8964" class="graf graf--li graf-after--li">Lessons I learned building production agentsâ€Šâ€”â€Šwhere people go wrong and how to avoid it.</li><li name="523a" id="523a" class="graf graf--li graf-after--li">How to add observability and testing so your agents donâ€™t silently break.</li></ul><p name="67df" id="67df" class="graf graf--p graf-after--li graf--trailing">This isnâ€™t theory. <strong class="markup--strong markup--p-strong">Itâ€™s the guide I wish I had read before I started trying to make agents.</strong></p></div></div></section><section name="48bc" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="dd4a" id="dd4a" class="graf graf--h3 graf--leading">The Problem</h3><p name="711e" id="711e" class="graf graf--p graf-after--h3">At work, I was asked to lead a project for major record labels to find influencers to promote music.</p><p name="373f" id="373f" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">The goal:</strong> give campaign creators a chat-like interface (as natural as ChatGPT) that could:</p><ul class="postList"><li name="4227" id="4227" class="graf graf--li graf--startsWithDoubleQuote graf-after--p">â€œFind 5 dance creators in Brazil with 100k+ followers.â€</li><li name="f28f" id="f28f" class="graf graf--li graf--startsWithDoubleQuote graf-after--li">â€œRemove anyone with engagement below 0.8.â€</li><li name="4844" id="4844" class="graf graf--li graf--startsWithDoubleQuote graf-after--li">â€œUpdate my budget to $5,000.â€</li></ul><p name="6b9d" id="6b9d" class="graf graf--p graf-after--li">All via conversation.</p><p name="67db" id="67db" class="graf graf--p graf-after--p graf--trailing">Behind the scenes, the system had to build and refine creator lists, update campaign settings, and surface insights about the creators.</p></div></div></section><section name="f915" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="50cd" id="50cd" class="graf graf--h3 graf--leading">Step 0: What an Agent <em class="markup--em markup--h3-em">Actually</em>Â Is</h3><p name="138b" id="138b" class="graf graf--p graf-after--h3">2025 was supposed to be the year of the â€œagentâ€.</p><p name="902b" id="902b" class="graf graf--p graf-after--p">Not happening people.</p><p name="7829" id="7829" class="graf graf--p graf-after--p">Behind the buzzwords lurks something pretty useful.</p><p name="3bc2" id="3bc2" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">An agent typically follows a pattern:</strong></p><ul class="postList"><li name="3e17" id="3e17" class="graf graf--li graf-after--p">Input: user text (messy, ambiguous, contextual).</li><li name="bf53" id="bf53" class="graf graf--li graf-after--li">Interpretation: convert your unstructured request to structured instructions.</li><li name="fd52" id="fd52" class="graf graf--li graf-after--li">Execution: do the thing (queries, API calls, updates) to achieve the userâ€™s desire (within reason).</li></ul><p name="9c26" id="9c26" class="graf graf--p graf-after--li">Example:</p><p name="8ef3" id="8ef3" class="graf graf--p graf-after--p">User: <em class="markup--em markup--p-em">â€œFind Canadian food bloggers with 100k followers.â€</em></p><p name="71b5" id="71b5" class="graf graf--p graf-after--p">Structured intent could be interpreted into something like this:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="javascript" name="caa5" id="caa5" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">{<br />  â€œactionâ€: â€œdatabaseâ€,<br />  â€œcriteriaâ€: {<br />    â€œcountryâ€: â€œ<span class="hljs-title class_">Canada</span>â€,<br />    â€œminFollowersâ€: <span class="hljs-number">100000</span>,<br />    â€œnicheâ€: â€œ<span class="hljs-title class_">Food</span>â€<br />  }<br />}</span></pre><p name="c4f5" id="c4f5" class="graf graf--p graf-after--pre">Why structured outputs? They give you a contract.</p><p name="90fd" id="90fd" class="graf graf--p graf-after--p">Free-form text is unpredictable; JSON gives us the type safety, testability, and safe execution we expect from traditional APIs.</p><p name="07b0" id="07b0" class="graf graf--p graf-after--p graf--trailing">More on that in a minute!</p></div></div></section><section name="8756" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="c06b" id="c06b" class="graf graf--h3 graf--leading">Lesson 1: Donâ€™t Build a Swiss-Army Agent</h3><p name="309c" id="309c" class="graf graf--p graf-after--h3">My first attempt at this project was a â€œdo-everythingâ€ agent: one giant prompt, tons of context, vague rules.</p><p name="c8dc" id="c8dc" class="graf graf--p graf-after--p">It was fragile and inconsistent. The fix was <strong class="markup--strong markup--p-strong">applying the Single Responsibility Principle</strong>: keep agents focused. One agent does one thing well.</p><p name="483b" id="483b" class="graf graf--p graf-after--p">Hereâ€™s the pattern Iâ€™m using:</p><ul class="postList"><li name="7b5a" id="7b5a" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Selector (Orchestrator)</strong>: decides what to do next. Can summarize a conversation and extract intent.</li><li name="845e" id="845e" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Database Agent: </strong>structured filters (followers, regions, niches) to find people.</li><li name="a6d5" id="a6d5" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Search Agent</strong>: semantic style/vibe (â€œcomedic creatorsâ€, â€œminimalist aestheticâ€, â€œcats who eat pizzaâ€).</li><li name="77af" id="77af" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Refine Agent</strong>: adjust an existing list (â€œremove under 100kâ€).</li><li name="7961" id="7961" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">General Agent</strong>: analysis and summaries. â€œWho is most likely to go viral?â€</li><li name="d24c" id="d24c" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Update Agent</strong>: budget, targets, goals. â€œUpdate my budget to 1 Million Dollarsâ€ (twirls mustache)</li><li name="b840" id="b840" class="graf graf--li graf-after--li graf--trailing"><strong class="markup--strong markup--li-strong">Launch Agent</strong>: finalization step to launch the campaign once they confirm theyâ€™re ready to gooooooo!</li></ul></div></div></section><section name="3681" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="1f7a" id="1f7a" class="graf graf--h3 graf--leading">Selector AgentÂ Example</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="typescript" name="b2b3" id="b2b3" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> { createTracedOpenAI } <span class="hljs-keyword">from</span> â€˜@/lib/serverOpenaiâ€™;<br /><span class="hljs-keyword">import</span> { zodTextFormat } <span class="hljs-keyword">from</span> â€˜openai/helpers/zodâ€™;<br /><span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> â€˜zodâ€™;<span class="hljs-keyword">type</span> <span class="hljs-title class_">RouteAction</span> =<br />  | â€˜databaseâ€™<br />  | â€˜searchâ€™<br />  | â€˜refineâ€™<br />  | â€˜generalâ€™<br />  | â€˜updateâ€™<br />  | â€˜launchâ€™<br />  | â€˜clarifyâ€™;<br /><br /><span class="hljs-keyword">type</span> <span class="hljs-title class_">SelectorResponse</span> = {<br />  <span class="hljs-attr">action</span>: <span class="hljs-title class_">RouteAction</span>;<br />  <span class="hljs-attr">reasoning</span>: <span class="hljs-built_in">string</span>;<br />  <span class="hljs-attr">agentRequest</span>: <span class="hljs-built_in">string</span>;<br />};<br /><br /><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">selectorAgent</span>(<span class="hljs-params"><br />  userQuery: <span class="hljs-built_in">string</span><br /></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">SelectorResponse</span>&gt; {<br />  <span class="hljs-keyword">const</span> openai = <span class="hljs-title function_">createTracedOpenAI</span>({<br />    <span class="hljs-attr">agentType</span>: <span class="hljs-string">&#x27;selector&#x27;</span>,<br />    <span class="hljs-attr">userId</span>: <span class="hljs-string">&#x27;example-user&#x27;</span>,<br />    <span class="hljs-attr">campaignId</span>: <span class="hljs-string">&#x27;example-campaign&#x27;</span>,<br />  });<br /><br />  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">responses</span>.<span class="hljs-title function_">parse</span>({<br />    <span class="hljs-attr">model</span>: <span class="hljs-string">&#x27;gpt-4o-mini&#x27;</span>,<br />    <span class="hljs-attr">input</span>: [<br />      {<br />        <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;system&#x27;</span>,<br />        <span class="hljs-attr">content</span>:<br />          <span class="hljs-string">&#x27;Route to one of: database, search, refine, general, update, launch, clarify.&#x27;</span>,<br />      },<br />      { <span class="hljs-attr">role</span>: <span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-attr">content</span>: userQuery },<br />    ],<br />    <span class="hljs-attr">text</span>: {<br />      <span class="hljs-attr">format</span>: <span class="hljs-title function_">zodTextFormat</span>(<br />        z.<span class="hljs-title function_">object</span>({<br />          <span class="hljs-attr">action</span>: z.<span class="hljs-title function_">enum</span>([<br />            <span class="hljs-string">&#x27;database&#x27;</span>,<br />            <span class="hljs-string">&#x27;search&#x27;</span>,<br />            <span class="hljs-string">&#x27;refine&#x27;</span>,<br />            <span class="hljs-string">&#x27;general&#x27;</span>,<br />            <span class="hljs-string">&#x27;update&#x27;</span>,<br />            <span class="hljs-string">&#x27;launch&#x27;</span>,<br />            <span class="hljs-string">&#x27;clarify&#x27;</span>,<br />          ]),<br />          <span class="hljs-attr">reasoning</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;Why the request was routed here&#x27;</span>),<br />          <span class="hljs-attr">agentRequest</span>: z<br />            .<span class="hljs-title function_">string</span>()<br />            .<span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;Concise request for the chosen agent&#x27;</span>),<br />        }),<br />        <span class="hljs-string">&#x27;agentResponse&#x27;</span><br />      ),<br />    },<br />  });<br />  <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">output_parsed</span>) {<br />    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Failed to parse AI response&#x27;</span>);<br />  }<br />  <span class="hljs-keyword">return</span> {<br />    <span class="hljs-attr">action</span>: result.<span class="hljs-property">output_parsed</span>.<span class="hljs-property">action</span>,<br />    <span class="hljs-attr">reasoning</span>: result.<span class="hljs-property">output_parsed</span>.<span class="hljs-property">reasoning</span>,<br />    <span class="hljs-attr">agentRequest</span>: result.<span class="hljs-property">output_parsed</span>.<span class="hljs-property">agentRequest</span>,<br />  };<br />}</span></pre><p name="e760" id="e760" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">Whatâ€™s happening here:</strong> Using OpenAIâ€™s API, we are passing a user query to be interpreted and a schema to the OpenAI library so that we get a structured response.</p><p name="0e2d" id="0e2d" class="graf graf--p graf-after--p">Now we can be confident the AI will return an object that matches what we expect!</p><p name="3a07" id="3a07" class="graf graf--p graf-after--p graf--trailing"><strong class="markup--strong markup--p-strong">Pro tip: </strong><em class="markup--em markup--p-em">I use the â€œdescribeâ€ property on the schema to help the model understand what each property will be used for. This appears to improve responses.</em></p></div></div></section><section name="ced6" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="fca9" id="fca9" class="graf graf--h3 graf--leading">Lesson 2: Donâ€™t Overfeed theÂ Model</h3><p name="9041" id="9041" class="graf graf--p graf-after--h3">Early on, I shoved full conversation histories and giant prompts into every request. It raised latency, costs, and errors.</p><p name="6353" id="6353" class="graf graf--p graf-after--p">BTWâ€Šâ€”â€ŠOpenAI is NOT free.</p><p name="ea77" id="ea77" class="graf graf--p graf-after--p">Experiments can be costly but honestly, for a small project, $10 will be sufficient.</p><p name="7355" id="7355" class="graf graf--p graf-after--p">Context is EVERYTHING.</p><blockquote name="bd90" id="bd90" class="graf graf--pullquote graf-after--p">In a conversation, if someone responds <em class="markup--em markup--pullquote-em">â€œyeah sureâ€</em>â€Šâ€”â€Šthat phrase is meaningless unless you know that the previous phrase was <em class="markup--em markup--pullquote-em">â€œAre you willing to sacrifice yourself for the greater good of humanity?â€</em></blockquote><p name="8811" id="8811" class="graf graf--p graf-after--pullquote">Agents need context to understand user intention but passing massive conversations each time a user hits â€œsubmitâ€ will result in errors from OpenAI which has a limit on context.</p><p name="1439" id="1439" class="graf graf--p graf-after--p">For example, you cannot pass a novella to OpenAI and expect it to handle that.</p><p name="db3a" id="db3a" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">The fix:</strong></p><ul class="postList"><li name="75ba" id="75ba" class="graf graf--li graf-after--p">Summarize the last 5 messages before routing.</li><li name="841e" id="841e" class="graf graf--li graf-after--li">Keep agent prompts short and precise.</li><li name="b5c8" id="b5c8" class="graf graf--li graf-after--li graf--trailing">Pass only what the next agent needs to perform the next task.</li></ul></div></div></section><section name="6059" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="e486" id="e486" class="graf graf--h3 graf--leading">Lesson 3: Orchestration &gt;Â Autonomy</h3><p name="4e14" id="4e14" class="graf graf--p graf-after--h3">Autonomous chains that take in an input and can call other agents at-will sounds really cool but when I experimented with this on a personal project, I had less visibility into why an agent called another agent or why they might loop infinitely and burn tokens at warp speed.</p><p name="9170" id="9170" class="graf graf--p graf-after--p">For this reason, I chose to use orchestration:</p><ul class="postList"><li name="e6c1" id="e6c1" class="graf graf--li graf-after--p">Selector chooses next agent.</li><li name="7076" id="7076" class="graf graf--li graf-after--li">One specialized agent executes.</li><li name="dcae" id="dcae" class="graf graf--li graf-after--li">Aggregator/formatter finalizes the output for the user.</li></ul><p name="8831" id="8831" class="graf graf--p graf-after--li">Keep chains to 2â€“3 hops. Reliability degrades as steps increase.</p><p name="b622" id="b622" class="graf graf--p graf-after--p">Hereâ€™s some math for you:</p><p name="2eee" id="2eee" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Some studies show AI agents have ~70% success rate for common office tasks</strong>. With multiple agents, your chance of failure increases as you add agents.</p><p name="ff62" id="ff62" class="graf graf--p graf-after--p">Letâ€™s be very generous and consider our agent has a 90% success rate.</p><blockquote name="5cbb" id="5cbb" class="graf graf--blockquote graf-after--p">2 agents: 90% of 90% = 81%</blockquote><blockquote name="5d0c" id="5d0c" class="graf graf--blockquote graf-after--blockquote">3 agents: 90% of 90% of 90% = 72%</blockquote><blockquote name="cad7" id="cad7" class="graf graf--blockquote graf-after--blockquote">4 agents: 90% of 90% of 90% of 90% = 66%</blockquote><p name="8464" id="8464" class="graf graf--p graf-after--blockquote graf--trailing">Math!</p></div></div></section><section name="b5e4" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="bdbb" id="bdbb" class="graf graf--h3 graf--leading">Lesson 4: You Canâ€™t Improve What You Donâ€™tÂ Measure</h3><p name="4899" id="4899" class="graf graf--p graf-after--h3">If you canâ€™t see what your agents did and why, you canâ€™t debug or improve them. Iâ€™ve used <a href="https://www.langchain.com/langsmith" data-href="https://www.langchain.com/langsmith" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">LangSmith</a> and <a href="https://www.helicone.ai/" data-href="https://www.helicone.ai/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Helicone</a> to trace calls and capture metadata.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="typescript" name="5343" id="5343" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> â€˜openaiâ€™;<br /><span class="hljs-keyword">import</span> { wrapOpenAI } <span class="hljs-keyword">from</span> â€˜langsmith/wrappersâ€™;<br /><br /><span class="hljs-keyword">const</span> baseOpenAI = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({ <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span> });<br /><br /><span class="hljs-comment">// Attach traces to a LangSmith project</span><br /><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> tracedOpenAI = <span class="hljs-title function_">wrapOpenAI</span>(baseOpenAI, {<br />  <span class="hljs-attr">project_name</span>: <span class="hljs-string">&#x27;example-agent-project&#x27;</span>,<br />});<br /><br /><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createTracedOpenAI</span>(<span class="hljs-params">agentType: <span class="hljs-built_in">string</span></span>) {<br />  <span class="hljs-keyword">return</span> <span class="hljs-title function_">wrapOpenAI</span>(baseOpenAI, {<br />    <span class="hljs-attr">project_name</span>: <span class="hljs-string">&#x27;example-agent-project&#x27;</span>,<br />    <span class="hljs-attr">tags</span>: [agentType],<br />    <span class="hljs-attr">metadata</span>: { <span class="hljs-attr">agent_type</span>: agentType },<br />  });<br />}</span></pre><p name="8cac" id="8cac" class="graf graf--p graf-after--pre">Now you can create a dashboard where you can see how agents are responding, the latency of the calls youâ€™re making and token costs.</p><p name="6a6b" id="6a6b" class="graf graf--p graf-after--p graf--trailing">This is basic software development practices for observing failures but made for this new era of AI everywhere <em class="markup--em markup--p-em">(whether you like it or not)</em>.</p></div></div></section><section name="b890" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="9958" id="9958" class="graf graf--h3 graf--leading">Lesson 5: There Will BeÂ Tests</h3><p name="7822" id="7822" class="graf graf--p graf-after--h3">I was on the fence about writing tests honestly.</p><p name="feb7" id="feb7" class="graf graf--p graf-after--p">Sometimes it feels like standard software development practices have just gone out the window in the age of AI. Iâ€™d argue that <strong class="markup--strong markup--p-strong">tests are even MORE important when using AI generated responses.</strong></p><p name="5a35" id="5a35" class="graf graf--p graf-after--p">Imagine this:</p><ul class="postList"><li name="2391" id="2391" class="graf graf--li graf-after--p">You have an agent working great.</li><li name="4de3" id="4de3" class="graf graf--li graf-after--li">OpenAI updates their code which you have no visibility into.</li><li name="6110" id="6110" class="graf graf--li graf-after--li">Maybe you just tweak a prompt.</li></ul><p name="3226" id="3226" class="graf graf--p graf-after--li">Things break spectacularly and you have no clue why or who to yell at.</p><p name="d3e7" id="d3e7" class="graf graf--p graf-after--p">A small test suite can save you a lot of headache if you structure your agents correctly.</p><p name="8dee" id="8dee" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">I decided to use â€œlive testsâ€ </strong>that hit the API with representative queries and check on the structured output to see if it matches my expectations.</p><p name="6c4a" id="6c4a" class="graf graf--p graf-after--p">This is yet another reason to use structure outputs, otherwise you may to have to use an <strong class="markup--strong markup--p-strong">LLM-as-judge </strong>approach to see if your output is â€œgood enoughâ€.</p><p name="a8e9" id="a8e9" class="graf graf--p graf-after--p">Basically, passing the output from the test to another LLM to check the quality.</p><p name="7454" id="7454" class="graf graf--p graf-after--p">To me, this seems brittle and error-prone (not to mention costly)</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="typescript" name="a153" id="a153" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> { selectorAgent } <span class="hljs-keyword">from</span> â€˜../agents/selectorâ€™;<br /><br /><span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;Selector Agent (routing)&#x27;</span>, <span class="hljs-function">() =&gt;</span> {<br />  <span class="hljs-title function_">it</span>(<span class="hljs-string">&#x27;routes common queries correctly&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; {<br />    <span class="hljs-keyword">const</span> cases = [<br />      { <span class="hljs-attr">q</span>: <span class="hljs-string">&#x27;Find Canadian food bloggers with 100k followers&#x27;</span>, <span class="hljs-attr">expected</span>: <span class="hljs-string">&#x27;database&#x27;</span> },<br />      { <span class="hljs-attr">q</span>: <span class="hljs-string">&#x27;Add creators with tattoos&#x27;</span>, <span class="hljs-attr">expected</span>: <span class="hljs-string">&#x27;search&#x27;</span> },<br />      { <span class="hljs-attr">q</span>: <span class="hljs-string">&#x27;Remove anyone under 50k followers&#x27;</span>, <span class="hljs-attr">expected</span>: <span class="hljs-string">&#x27;refine&#x27;</span> },<br />      { <span class="hljs-attr">q</span>: <span class="hljs-string">&#x27;Update my budget to $10,000&#x27;</span>, <span class="hljs-attr">expected</span>: <span class="hljs-string">&#x27;update&#x27;</span> },<br />    ];<br />    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> c <span class="hljs-keyword">of</span> cases) {<br />      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">selectorAgent</span>(c.<span class="hljs-property">q</span>);<br />      <span class="hljs-title function_">expect</span>(res.<span class="hljs-property">action</span>).<span class="hljs-title function_">toBe</span>(c.<span class="hljs-property">expected</span>);<br />      <span class="hljs-title function_">expect</span>(res.<span class="hljs-property">agentRequest</span>).<span class="hljs-title function_">toBeTruthy</span>();<br />    }<br />  }, <span class="hljs-number">60000</span>);<br />});</span></pre><p name="181a" id="181a" class="graf graf--p graf-after--pre">Yes, this costs tokens.</p><p name="25ae" id="25ae" class="graf graf--p graf-after--p graf--trailing">Itâ€™s cheaper than shipping bugs and losing customers or the 2 strands of hair I have left on my shiny head.</p></div></div></section><section name="05db" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="6bcd" id="6bcd" class="graf graf--h3 graf--leading">Lesson 6: Keep Agents Focused on Structured Criteria</h3><p name="0eff" id="0eff" class="graf graf--p graf-after--h3">Never let your model write raw database queries. Extract structured filters from text, then let your ORM/queries enforce reality.</p><p name="e206" id="e206" class="graf graf--p graf-after--p">This can be really powerful when you want to create a query from a user request.</p><p name="02d6" id="02d6" class="graf graf--p graf-after--p">I follow this pattern:</p><ul class="postList"><li name="41e0" id="41e0" class="graf graf--li graf-after--p">Do a query for possible values that our DB can accept.</li><li name="5d19" id="5d19" class="graf graf--li graf-after--li">Agent uses this context and the user query to extract valid values to use in a database query.</li><li name="f839" id="f839" class="graf graf--li graf-after--li">Enforce types using zod so we donâ€™t use strings as numbers or vice-versa.</li></ul><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="javascript" name="b38a" id="b38a" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> â€œzodâ€;<br /><span class="hljs-keyword">import</span> { zodTextFormat } <span class="hljs-keyword">from</span> â€œopenai/helpers/zodâ€;<br /><span class="hljs-keyword">import</span> { createOpenAI } <span class="hljs-keyword">from</span> â€œ./lib/openaiâ€;</span></pre><pre name="2087" id="2087" class="graf graf--pre graf-after--pre">// Define what fields we allow the model to return<br>const searchSchema = z.object({<br>  country: z.string().optional(),<br>  niche: z.string().optional(),<br>  minFollowers: z.number().nullable().optional(),<br>  maxFollowers: z.number().nullable().optional(),<br>});</pre><pre name="a15a" id="a15a" class="graf graf--pre graf-after--pre">const MOCK = [<br>  { handle: â€œfoodie_caâ€, followers: 120000, country: â€œCanadaâ€, niche: â€œFoodâ€ },<br>  { handle: â€œveganchefâ€, followers: 98000, country: â€œCanadaâ€, niche: â€œFoodâ€ },<br>  { handle: â€œtravel_guruâ€, followers: 240000, country: â€œUSAâ€, niche: â€œTravelâ€ },<br>];</pre><pre name="5b31" id="5b31" class="graf graf--pre graf-after--pre">const userQuery = â€œFind food influencers in Canada with over 100k followersâ€;</pre><pre name="872e" id="872e" class="graf graf--pre graf-after--pre">async function safeSearch(userQuery: string) {<br>  const openai = createOpenAI();<br>  // Let the model parse search criteria â€” not SQL<br>  const parsed = await openai.responses.parse({<br>    model: â€œgpt-4o-miniâ€,<br>    input: `Extract structured search filters from this request: â€œ${userQuery}â€`,<br>    text: { format: zodTextFormat(searchSchema, â€œcriteriaâ€) },<br>  });</pre><pre name="c6ea" id="c6ea" class="graf graf--pre graf-after--pre">  const criteria = parsed.output_parsed;</pre><pre name="511e" id="511e" class="graf graf--pre graf-after--pre">  // Apply filters in your own code or ORM<br>  return MOCK.filter(<br>    (c) =&gt;<br>      (!criteria.country || c.country === criteria.country) &amp;&amp;<br>      (!criteria.niche || c.niche === criteria.niche) &amp;&amp;<br>      (!criteria.minFollowers || c.followers &gt;= criteria.minFollowers) &amp;&amp;<br>      (!criteria.maxFollowers || c.followers &lt;= criteria.maxFollowers)<br>  );<br>}</pre><pre name="8c1e" id="8c1e" class="graf graf--pre graf-after--pre graf--trailing">safeSearch(userQuery).then(console.log);</pre></div></div></section><section name="1661" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="3487" id="3487" class="graf graf--h3 graf--leading">A Minimal End-to-End Example</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="typescript" name="b728" id="b728" class="graf graf--pre graf-after--h3 graf--trailing graf--preV2"><span class="pre--content"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">runDemo</span>(<span class="hljs-params"></span>) {<br />  <span class="hljs-keyword">const</span> query = â€˜<span class="hljs-title class_">Find</span> <span class="hljs-title class_">Canadian</span> food bloggers <span class="hljs-keyword">with</span> 100k followersâ€™;<br /><br />  <span class="hljs-keyword">const</span> route = <span class="hljs-keyword">await</span> <span class="hljs-title function_">selectorAgent</span>(query);<br /><br />  <span class="hljs-keyword">if</span> (route.<span class="hljs-property">action</span> === <span class="hljs-string">&#x27;database&#x27;</span>) {<br />    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title function_">safeSearch</span>(route.<span class="hljs-property">agentQuery</span>);<br />    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Creators:&#x27;</span>, results);<br />  } <span class="hljs-keyword">else</span> {<br />    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Unhandled action:&#x27;</span>, route.<span class="hljs-property">action</span>);<br />  }<br />}<br /><br /><span class="hljs-title function_">runDemo</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);</span></pre></div></div></section><section name="ac92" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="c730" id="c730" class="graf graf--h3 graf--leading">There Are NoÂ Rules</h3><p name="b49e" id="b49e" class="graf graf--p graf-after--h3">There isnâ€™t a right way to build agents but there are many wrong ways.</p><p name="a759" id="a759" class="graf graf--p graf-after--p">I shared what is working for me in the real world. Not a tutorial. Not my 1 person â€œstartupâ€ with zero customers. Iâ€™ve built and shipped agents out in the wild with actual users.</p><p name="5fa4" id="5fa4" class="graf graf--p graf-after--p">Hereâ€™s the thing: most of the tools in this space are a year or two old.</p><p name="f678" id="f678" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">The rules are still being written.</strong></p><p name="04ec" id="04ec" class="graf graf--p graf-after--p">In a few months, Iâ€™ll probably disagree with parts of this article. Maybe all of it.</p><p name="3f59" id="3f59" class="graf graf--p graf-after--p">Thatâ€™s fine.</p><p name="fa1d" id="fa1d" class="graf graf--p graf-after--p">Weâ€™re all learning in public.</p><p name="cb2c" id="cb2c" class="graf graf--p graf-after--p">The fun is in building, testing, and sharing what works.</p><blockquote name="b5b4" id="b5b4" class="graf graf--blockquote graf-after--p"><em class="markup--em markup--blockquote-em">Want to go deeper down the rabbit hole? ğŸ‘‡</em></blockquote><h4 name="6432" id="6432" class="graf graf--h4 graf-after--blockquote graf--trailing"><em class="markup--em markup--h4-em">Check out this project to learn RAG with AI and Typescript. Hands-on type shit for developers who want to build. </em><a href="https://parsity.io/ai-with-rag" data-href="https://parsity.io/ai-with-rag" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank"><em class="markup--em markup--h4-em">Build a Cringy influencer to learnÂ RAG</em></a></h4></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@brianjenney" class="p-author h-card">Brian Jenney</a> on <a href="https://medium.com/p/30efce169473"><time class="dt-published" datetime="2025-10-04T22:56:36.139Z">October 4, 2025</time></a>.</p><p><a href="https://medium.com/@brianjenney/a-practical-guide-on-building-ai-agents-30efce169473" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 30, 2025.</p></footer></article></body></html>